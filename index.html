<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Shop Pro - Advanced Business Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --coffee-dark: #5C3D2E;
            --coffee-brown: #8B6F47;
            --coffee-light: #D4A574;
            --coffee-accent: #FFD700;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f1e8 0%, #e8e0d5 100%);
            color: var(--coffee-dark);
        }

        /* Navbar */
        .navbar {
            background: linear-gradient(135deg, var(--coffee-dark) 0%, var(--coffee-brown) 100%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            padding: 1rem 0;
        }

        .navbar-brand {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--coffee-accent) !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-link {
            color: white !important;
            margin: 0 5px;
            padding: 8px 15px !important;
            border-radius: 5px;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .nav-link:hover, .nav-link.active {
            background-color: var(--coffee-light);
            color: var(--coffee-dark) !important;
            transform: translateY(-2px);
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 70px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            height: fit-content;
        }

        .sidebar-title {
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--coffee-dark);
            margin-bottom: 15px;
            border-bottom: 3px solid var(--coffee-light);
            padding-bottom: 10px;
        }

        .sidebar .nav-link {
            color: var(--coffee-dark) !important;
            padding: 12px 15px !important;
            margin-bottom: 8px;
            border-left: 4px solid transparent;
            border-radius: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar .nav-link:hover {
            background: rgba(139, 111, 71, 0.1);
            border-left-color: var(--coffee-light);
            padding-left: 20px !important;
            transform: none;
        }

        .sidebar .nav-link.active {
            background: linear-gradient(135deg, var(--coffee-dark) 0%, var(--coffee-brown) 100%);
            color: white !important;
            border-left-color: var(--coffee-accent);
            font-weight: 600;
        }

        /* Pages */
        .page {
            display: none;
            animation: fadeIn 0.4s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stat Cards */
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-top: 4px solid var(--coffee-light);
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .stat-icon {
            font-size: 2.5rem;
            color: var(--coffee-brown);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--coffee-dark);
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: #999;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, var(--coffee-dark) 0%, var(--coffee-brown) 100%);
            color: white;
            border: none;
            padding: 20px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .card-body {
            padding: 25px;
        }

        /* Tables */
        .table {
            margin-bottom: 0;
        }

        .table thead th {
            background: linear-gradient(135deg, var(--coffee-dark) 0%, var(--coffee-brown) 100%);
            color: white;
            border: none;
            padding: 15px;
            font-weight: 600;
        }

        .table tbody tr {
            border-color: #eee;
            transition: all 0.2s;
        }

        .table tbody tr:hover {
            background-color: rgba(139, 111, 71, 0.05);
            transform: scale(1.01);
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--coffee-dark) 0%, var(--coffee-brown) 100%);
            border: none;
            font-weight: 600;
            padding: 10px 20px;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(139, 111, 71, 0.3);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Forms */
        .form-control, .form-select {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px 15px;
            transition: all 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--coffee-brown);
            box-shadow: 0 0 0 0.2rem rgba(139, 111, 71, 0.15);
        }

        .form-label {
            font-weight: 600;
            color: var(--coffee-dark);
            margin-bottom: 8px;
        }

        /* Modals */
        .modal-header {
            background: linear-gradient(135deg, var(--coffee-dark) 0%, var(--coffee-brown) 100%);
            color: white;
            border: none;
        }

        .modal-title {
            font-weight: 700;
            font-size: 1.3rem;
        }

        /* Alerts & Badges */
        .alert {
            border: none;
            border-left: 5px solid;
            border-radius: 8px;
            padding: 15px 20px;
        }

        .badge {
            padding: 8px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 350px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        /* Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Low Stock */
        .low-stock {
            background-color: #fff5f5;
            border-left: 5px solid var(--danger);
        }

        /* POS */
        .pos-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            margin-bottom: 10px;
        }

        .pos-item:hover {
            transform: translateY(-5px);
            border-color: var(--coffee-light);
            box-shadow: 0 6px 15px rgba(139, 111, 71, 0.2);
        }

        .pos-item.active {
            background: linear-gradient(135deg, var(--coffee-dark) 0%, var(--coffee-brown) 100%);
            color: white;
            border-color: var(--coffee-accent);
        }

        /* Orders Display */
        .order-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--coffee-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Strategy Boxes */
        .strategy-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--coffee-light);
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }

        .strategy-box h6 {
            color: var(--coffee-dark);
            font-weight: 700;
            margin-bottom: 8px;
        }

        .strategy-box small {
            color: #666;
        }

        /* Footer */
        footer {
            background: var(--coffee-dark);
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                top: 0;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .nav-link {
                font-size: 0.85rem;
                padding: 6px 12px !important;
            }
        }

        /* Loyalty Tiers */
        .loyalty-tier {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 5px solid;
        }

        .tier-bronze { background: #f5e6d3; border-left-color: #cd7f32; }
        .tier-silver { background: #e8e8e8; border-left-color: #c0c0c0; }
        .tier-gold { background: #fffacd; border-left-color: #ffd700; }

        /* Progress Bar */
        .progress-custom {
            height: 25px;
            background-color: #eee;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--coffee-brown) 0%, var(--coffee-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.75rem;
        }

        /* Tabs */
        .nav-tabs .nav-link {
            color: var(--coffee-dark) !important;
            border: none;
            border-bottom: 3px solid transparent;
            padding: 12px 20px !important;
            margin-bottom: -3px;
        }

        .nav-tabs .nav-link.active {
            background: none;
            border-bottom-color: var(--coffee-brown);
            color: var(--coffee-brown) !important;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-coffee"></i> CoffeeShop Pro</a>
            <button class="navbar-toggler btn-light" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('dashboard')"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('pos')"><i class="fas fa-cash-register"></i> POS</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('inventory')"><i class="fas fa-boxes"></i> Inventory</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('financial')"><i class="fas fa-chart-bar"></i> Finance</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('loyalty')"><i class="fas fa-gift"></i> Loyalty</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('staff')"><i class="fas fa-users"></i> Staff</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('strategy')"><i class="fas fa-lightbulb"></i> Strategy</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="switchPage('reports')"><i class="fas fa-file-pdf"></i> Reports</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-2 mb-4">
                <div class="sidebar">
                    <div class="sidebar-title"><i class="fas fa-bars"></i> Menu</div>
                    <a href="#" class="nav-link active" onclick="switchPage('dashboard')"><i class="fas fa-home"></i> Dashboard</a>
                    <a href="#" class="nav-link" onclick="switchPage('pos')"><i class="fas fa-cash-register"></i> Point of Sale</a>
                    <a href="#" class="nav-link" onclick="switchPage('inventory')"><i class="fas fa-boxes"></i> Inventory</a>
                    <a href="#" class="nav-link" onclick="switchPage('financial')"><i class="fas fa-dollar-sign"></i> Finance</a>
                    <a href="#" class="nav-link" onclick="switchPage('loyalty')"><i class="fas fa-star"></i> Customers</a>
                    <a href="#" class="nav-link" onclick="switchPage('staff')"><i class="fas fa-people"></i> Staff</a>
                    <a href="#" class="nav-link" onclick="switchPage('strategy')"><i class="fas fa-rocket"></i> Strategy</a>
                    <a href="#" class="nav-link" onclick="switchPage('reports')"><i class="fas fa-chart-line"></i> Reports</a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-10">
                <!-- DASHBOARD PAGE -->
                <div id="dashboard" class="page active">
                    <h2 class="mb-4"><i class="fas fa-chart-line"></i> Business Dashboard</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-arrow-up text-success"></i></div>
                            <div class="stat-label">Today Income</div>
                            <div class="stat-value" id="dashIncome">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-arrow-down text-danger"></i></div>
                            <div class="stat-label">Today Expenses</div>
                            <div class="stat-value" id="dashExpense">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-coins text-warning"></i></div>
                            <div class="stat-label">Net Profit</div>
                            <div class="stat-value" id="dashProfit">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-shopping-bag text-info"></i></div>
                            <div class="stat-label">Orders Today</div>
                            <div class="stat-value" id="dashOrders">0</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-fire"></i> Top 5 Products</div>
                                <div class="card-body" id="topProducts">
                                    <p class="text-muted">No data yet</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-exclamation-triangle"></i> Low Stock Alerts</div>
                                <div class="card-body" id="lowStockAlerts">
                                    <p class="text-muted">All items in stock</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header"><i class="fas fa-chart-area"></i> Recent Transactions</div>
                        <div class="card-body" id="recentOrders" style="max-height: 400px; overflow-y: auto;">
                            <p class="text-muted">No transactions</p>
                        </div>
                    </div>
                </div>

                <!-- POS PAGE -->
                <div id="pos" class="page">
                    <h2 class="mb-4"><i class="fas fa-cash-register"></i> Point of Sale</h2>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">Quick Menu</div>
                                <div class="card-body">
                                    <div class="row" id="posMenu"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-receipt"></i> Order Summary</div>
                                <div class="card-body">
                                    <div id="orderItems" style="max-height: 300px; overflow-y: auto; margin-bottom: 15px;">
                                        <p class="text-muted">No items</p>
                                    </div>
                                    <hr>
                                    <div class="mb-2"><strong>Subtotal:</strong> <span id="posSubtotal">$0</span></div>
                                    <div class="mb-3"><strong>Tax (10%):</strong> <span id="posTax">$0</span></div>
                                    <div class="alert alert-info mb-3">
                                        <strong>Total: <span id="posTotal">$0</span></strong>
                                    </div>
                                    <button class="btn btn-success w-100 mb-2" onclick="completePOSOrder()"><i class="fas fa-check"></i> Complete Order</button>
                                    <button class="btn btn-secondary w-100" onclick="clearPOSOrder()"><i class="fas fa-trash"></i> Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- INVENTORY PAGE -->
                <div id="inventory" class="page">
                    <h2 class="mb-4"><i class="fas fa-boxes"></i> Inventory Management</h2>
                    
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#inventoryModal">
                        <i class="fas fa-plus"></i> Add Item
                    </button>

                    <div class="card">
                        <div class="card-header">Stock Levels</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Category</th>
                                            <th>Stock</th>
                                            <th>Min Level</th>
                                            <th>Unit Cost</th>
                                            <th>Status</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-trash"></i> Waste Tracking</div>
                                <div class="card-body">
                                    <select id="wasteItem" class="form-select mb-3"></select>
                                    <input type="number" id="wasteQty" class="form-control mb-3" placeholder="Quantity">
                                    <select id="wasteReason" class="form-select mb-3">
                                        <option value="Expired">Expired</option>
                                        <option value="Damaged">Damaged</option>
                                        <option value="Spillage">Spillage</option>
                                    </select>
                                    <button class="btn btn-warning w-100" onclick="recordWaste()">Record Waste</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-truck"></i> Suppliers</div>
                                <div class="card-body" id="suppliersList"></div>
                                <div class="card-body border-top">
                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#supplierModal">
                                        <i class="fas fa-plus"></i> Add Supplier
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FINANCIAL PAGE -->
                <div id="financial" class="page">
                    <h2 class="mb-4"><i class="fas fa-chart-bar"></i> Financial Management</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Monthly Income</div>
                            <div class="stat-value" id="monthIncome">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Monthly Expenses</div>
                            <div class="stat-value" id="monthExpense">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Monthly Profit</div>
                            <div class="stat-value" id="monthProfit">$0</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#incomeModal">
                                <i class="fas fa-plus"></i> Add Income
                            </button>
                            <div class="card">
                                <div class="card-header">Income Records</div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Category</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="incomeTable"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <button class="btn btn-danger mb-3" data-bs-toggle="modal" data-bs-target="#expenseModal">
                                <i class="fas fa-minus"></i> Add Expense
                            </button>
                            <div class="card">
                                <div class="card-header">Expense Records</div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Category</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="expenseTable"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">Break-Even Analysis</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Fixed Monthly Costs ($)</label>
                                        <input type="number" id="fixedCosts" class="form-control" value="3000">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Average Cost Per Item ($)</label>
                                        <input type="number" id="itemCost" class="form-control" value="2">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Average Selling Price ($)</label>
                                        <input type="number" id="itemPrice" class="form-control" value="5">
                                    </div>
                                    <div class="alert alert-info">
                                        <strong>Break-Even:</strong> <span id="breakEven">0</span> items/month
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="calculateBreakEven()">Calculate</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">Expense Distribution</div>
                                <div class="chart-container">
                                    <canvas id="expenseChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LOYALTY PAGE -->
                <div id="loyalty" class="page">
                    <h2 class="mb-4"><i class="fas fa-star"></i> Customer & Loyalty Program</h2>
                    
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#customerModal">
                        <i class="fas fa-plus"></i> Add Customer
                    </button>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Customers</div>
                            <div class="stat-value" id="totalCusts">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Repeat Customers</div>
                            <div class="stat-value" id="repeatCusts">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Avg Rating</div>
                            <div class="stat-value" id="avgRating">0★</div>
                        </div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">Loyalty Tiers</div>
                        <div class="card-body">
                            <div class="loyalty-tier tier-bronze">
                                <h6><i class="fas fa-medal"></i> Bronze: 0-49 Points</h6>
                                <small>Welcome discount, email updates</small>
                            </div>
                            <div class="loyalty-tier tier-silver">
                                <h6><i class="fas fa-medal"></i> Silver: 50-99 Points</h6>
                                <small>5% discount, free drink every 10 visits</small>
                            </div>
                            <div class="loyalty-tier tier-gold">
                                <h6><i class="fas fa-medal"></i> Gold: 100+ Points</h6>
                                <small>10% discount, priority seating, exclusive menu</small>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">Customer Database</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Loyalty Pts</th>
                                            <th>Tier</th>
                                            <th>Visits</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customerTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAFF PAGE -->
                <div id="staff" class="page">
                    <h2 class="mb-4"><i class="fas fa-users"></i> Staff & Operations</h2>
                    
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#staffModal">
                        <i class="fas fa-plus"></i> Add Staff
                    </button>

                    <div class="stat-card">
                        <div class="stat-label">Total Monthly Payroll</div>
                        <div class="stat-value" id="totalPayroll">$0</div>
                    </div>

                    <div class="card">
                        <div class="card-header">Staff Directory</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Position</th>
                                            <th>Salary</th>
                                            <th>Started</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="staffTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-calendar"></i> Shift Schedule</div>
                                <div class="card-body">
                                    <select id="shiftStaff" class="form-select mb-3"></select>
                                    <input type="date" id="shiftDate" class="form-control mb-3">
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="time" id="shiftStart" class="form-control mb-3" placeholder="Start">
                                        </div>
                                        <div class="col-6">
                                            <input type="time" id="shiftEnd" class="form-control mb-3" placeholder="End">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="addShift()">Add Shift</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-checklist"></i> Opening Checklist</div>
                                <div class="card-body">
                                    <div class="mb-2"><input type="checkbox"> Clean work areas</div>
                                    <div class="mb-2"><input type="checkbox"> Check equipment</div>
                                    <div class="mb-2"><input type="checkbox"> Count cash register</div>
                                    <div class="mb-2"><input type="checkbox"> Review inventory</div>
                                    <div class="mb-2"><input type="checkbox"> Brief staff on goals</div>
                                    <button class="btn btn-success w-100 mt-3" onclick="saveChecklist()">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STRATEGY PAGE -->
                <div id="strategy" class="page">
                    <h2 class="mb-4"><i class="fas fa-rocket"></i> Business Strategy & Growth</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Avg Ticket Size</div>
                            <div class="stat-value" id="avgTicket">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Peak Hour</div>
                            <div class="stat-value" id="peakHour">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Top Product</div>
                            <div class="stat-value" id="topProduct">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Repeat Rate</div>
                            <div class="stat-value" id="repeatRate">0%</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">Monthly Sales Goal</div>
                                <div class="card-body">
                                    <input type="number" id="salesTarget" class="form-control mb-3" placeholder="$">
                                    <div class="progress-custom">
                                        <div class="progress-fill" id="goalBar" style="width: 0%">0%</div>
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="updateGoalProgress()">Update</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header"><i class="fas fa-bullhorn"></i> Campaign Tracking</div>
                                <div class="card-body">
                                    <input type="text" id="campaignName" class="form-control mb-3" placeholder="Campaign name">
                                    <input type="number" id="campaignImpact" class="form-control mb-3" placeholder="Impact %">
                                    <button class="btn btn-success w-100" onclick="launchCampaign()">Launch Campaign</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">8-Point Business Strategy Framework</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="strategy-box">
                                        <h6>1. Clear Concept & Brand</h6>
                                        <small>Modern, cozy café with unique identity and signature drinks</small>
                                    </div>
                                    <div class="strategy-box">
                                        <h6>2. Target Customers</h6>
                                        <small>Students, office workers, tourists - understand their needs</small>
                                    </div>
                                    <div class="strategy-box">
                                        <h6>3. Prime Location</h6>
                                        <small>High foot traffic, easy access, visible signage</small>
                                    </div>
                                    <div class="strategy-box">
                                        <h6>4. Quality Products</h6>
                                        <small>Premium beans, fresh ingredients, consistent taste</small>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="strategy-box">
                                        <h6>5. Competitive Pricing</h6>
                                        <small>Affordable but profitable, clear pricing, combo deals</small>
                                    </div>
                                    <div class="strategy-box">
                                        <h6>6. Customer Experience</h6>
                                        <small>Clean space, friendly staff, free Wi-Fi, comfortable seating</small>
                                    </div>
                                    <div class="strategy-box">
                                        <h6>7. Marketing & Loyalty</h6>
                                        <small>Social media, loyalty program, customer feedback</small>
                                    </div>
                                    <div class="strategy-box">
                                        <h6>8. Operations & Growth</h6>
                                        <small>Trained staff, clear procedures, expansion plans</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- REPORTS PAGE -->
                <div id="reports" class="page">
                    <h2 class="mb-4"><i class="fas fa-file-pdf"></i> Reports & Analytics</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-3"><button class="btn btn-primary w-100" onclick="generateDailyReport()"><i class="fas fa-calendar-day"></i> Daily</button></div>
                        <div class="col-md-3"><button class="btn btn-primary w-100" onclick="generateWeeklyReport()"><i class="fas fa-calendar-week"></i> Weekly</button></div>
                        <div class="col-md-3"><button class="btn btn-primary w-100" onclick="generateMonthlyReport()"><i class="fas fa-calendar"></i> Monthly</button></div>
                        <div class="col-md-3"><button class="btn btn-success w-100" onclick="exportData()"><i class="fas fa-download"></i> Export</button></div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">Sales Trend (7 Days)</div>
                                <div class="chart-container">
                                    <canvas id="trendChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">Product Performance</div>
                                <div class="chart-container">
                                    <canvas id="productChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">Generated Reports</div>
                        <div class="card-body" id="reportsList">
                            <p class="text-muted">No reports generated</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal fade" id="incomeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Income</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select id="incomeCategory" class="form-select">
                            <option value="Sales">Sales</option>
                            <option value="Delivery">Delivery</option>
                            <option value="Catering">Catering</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Amount</label>
                        <input type="number" id="incomeAmount" class="form-control" step="0.01">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <input type="text" id="incomeDesc" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addIncome()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="expenseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Expense</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select id="expenseCategory" class="form-select">
                            <option value="Rent">Rent</option>
                            <option value="Ingredients">Ingredients</option>
                            <option value="Salary">Salary</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Amount</label>
                        <input type="number" id="expenseAmount" class="form-control" step="0.01">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <input type="text" id="expenseDesc" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addExpense()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="inventoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Inventory Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Item Name</label>
                        <input type="text" id="invName" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select id="invCategory" class="form-select">
                            <option value="Coffee Beans">Coffee Beans</option>
                            <option value="Milk">Milk</option>
                            <option value="Snacks">Snacks</option>
                            <option value="Supplies">Supplies</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Stock Quantity</label>
                        <input type="number" id="invStock" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Min Level</label>
                        <input type="number" id="invMin" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Unit Cost</label>
                        <input type="number" id="invCost" class="form-control" step="0.01">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addInventory()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="staffModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Staff Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" id="staffName" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Position</label>
                        <select id="staffPosition" class="form-select">
                            <option value="Barista">Barista</option>
                            <option value="Manager">Manager</option>
                            <option value="Cashier">Cashier</option>
                            <option value="Cleaner">Cleaner</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Monthly Salary</label>
                        <input type="number" id="staffSalary" class="form-control" step="0.01">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" id="staffStart" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addStaff()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" id="custName" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" id="custEmail" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="tel" id="custPhone" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addCustomer()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="supplierModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Supplier Name</label>
                        <input type="text" id="supplierName" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contact</label>
                        <input type="text" id="supplierContact" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="tel" id="supplierPhone" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" id="supplierEmail" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="addSupplier()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // ===== DATA =====
        const db = {
            products: [
                { id: 1, name: 'Espresso', price: 2.5, category: 'Coffee', cost: 0.8 },
                { id: 2, name: 'Cappuccino', price: 4.5, category: 'Coffee', cost: 1.5 },
                { id: 3, name: 'Latte', price: 5, category: 'Coffee', cost: 1.8 },
                { id: 4, name: 'Americano', price: 3.5, category: 'Coffee', cost: 1 },
                { id: 5, name: 'Macchiato', price: 4, category: 'Coffee', cost: 1.4 },
                { id: 6, name: 'Green Tea', price: 3.5, category: 'Tea', cost: 0.7 },
                { id: 7, name: 'Croissant', price: 3.5, category: 'Food', cost: 1 },
                { id: 8, name: 'Muffin', price: 3, category: 'Food', cost: 0.8 }
            ],
            orders: [],
            income: [],
            expenses: [],
            inventory: [],
            staff: [],
            customers: [],
            suppliers: [],
            currentOrder: [],
            reports: []
        };

        function loadData() {
            const saved = localStorage.getItem('coffeeShopDB');
            if (saved) Object.assign(db, JSON.parse(saved));
            initializeData();
        }

        function initializeData() {
            if (db.inventory.length === 0) {
                db.inventory = [
                    { id: 1, name: 'Arabica Beans', category: 'Coffee Beans', stock: 50, min: 20, cost: 15 },
                    { id: 2, name: 'Fresh Milk', category: 'Milk', stock: 100, min: 40, cost: 3 },
                    { id: 3, name: 'Almond Milk', category: 'Milk', stock: 20, min: 10, cost: 4 }
                ];
            }
            if (db.suppliers.length === 0) {
                db.suppliers = [
                    { id: 1, name: 'Premium Coffee Co.', contact: 'John Smith', phone: '555-0101', email: 'john@coffee.com' },
                    { id: 2, name: 'Fresh Dairy', contact: 'Sarah Lee', phone: '555-0102', email: 'sarah@dairy.com' }
                ];
            }
        }

        function saveData() {
            localStorage.setItem('coffeeShopDB', JSON.stringify(db));
        }

        // ===== PAGE NAVIGATION =====
        function switchPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            
            document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
            event.target.closest('.nav-link').classList.add('active');

            if (page === 'dashboard') updateDashboard();
            else if (page === 'financial') updateFinancial();
            else if (page === 'inventory') updateInventory();
            else if (page === 'staff') updateStaff();
            else if (page === 'loyalty') updateLoyalty();
            else if (page === 'strategy') updateStrategy();
            else if (page === 'reports') updateReports();
            else if (page === 'pos') updatePOS();
        }

        // ===== POS =====
        function updatePOS() {
            const menu = document.getElementById('posMenu');
            menu.innerHTML = '';
            db.products.forEach(p => {
                menu.innerHTML += `
                    <div class="col-md-4">
                        <div class="pos-item" onclick="addToPOS(${p.id}, '${p.name}', ${p.price})">
                            <h6>${p.name}</h6>
                            <p class="text-success fw-bold">$${p.price}</p>
                        </div>
                    </div>
                `;
            });
        }

        function addToPOS(id, name, price) {
            const existing = db.currentOrder.find(i => i.id === id);
            if (existing) {
                existing.qty++;
            } else {
                db.currentOrder.push({ id, name, price, qty: 1 });
            }
            refreshPOSOrder();
        }

        function refreshPOSOrder() {
            const items = document.getElementById('orderItems');
            items.innerHTML = '';
            let subtotal = 0;

            db.currentOrder.forEach((item, idx) => {
                const total = item.price * item.qty;
                subtotal += total;
                items.innerHTML += `
                    <div class="order-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>$${item.price} x ${item.qty}</small>
                        </div>
                        <div>
                            <span class="badge bg-info">$${total.toFixed(2)}</span>
                            <button class="btn btn-sm btn-danger" onclick="removeFromOrder(${idx})">×</button>
                        </div>
                    </div>
                `;
            });

            if (db.currentOrder.length === 0) {
                items.innerHTML = '<p class="text-muted">No items</p>';
            }

            const tax = subtotal * 0.1;
            const total = subtotal + tax;

            document.getElementById('posSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('posTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('posTotal').textContent = `$${total.toFixed(2)}`;
        }

        function removeFromOrder(idx) {
            db.currentOrder.splice(idx, 1);
            refreshPOSOrder();
        }

        function completePOSOrder() {
            if (db.currentOrder.length === 0) {
                alert('No items in order');
                return;
            }

            const total = parseFloat(document.getElementById('posTotal').textContent.replace('$', ''));
            const order = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                items: [...db.currentOrder],
                total: total
            };

            db.orders.push(order);
            
            const income = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                category: 'Sales',
                amount: total,
                description: `Order ${order.id}`
            };
            db.income.push(income);

            saveData();
            clearPOSOrder();
            alert(`Order completed: $${total.toFixed(2)}`);
        }

        function clearPOSOrder() {
            db.currentOrder = [];
            refreshPOSOrder();
        }

        // ===== INVENTORY =====
        function updateInventory() {
            const table = document.getElementById('inventoryTable');
            table.innerHTML = '';
            
            db.inventory.forEach(item => {
                const status = item.stock <= item.min ? 
                    '<span class="badge bg-danger">Low</span>' : 
                    '<span class="badge bg-success">OK</span>';
                
                table.innerHTML += `
                    <tr ${item.stock <= item.min ? 'class="low-stock"' : ''}>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.category}</td>
                        <td>${item.stock}</td>
                        <td>${item.min}</td>
                        <td>$${item.cost}</td>
                        <td>${status}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteInv(${item.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });

            const wasteSelect = document.getElementById('wasteItem');
            wasteSelect.innerHTML = '';
            db.inventory.forEach(item => {
                wasteSelect.innerHTML += `<option value="${item.id}">${item.name}</option>`;
            });

            updateLowStockAlerts();
            updateSuppliers();
        }

        function updateLowStockAlerts() {
            const alerts = document.getElementById('lowStockAlerts');
            const low = db.inventory.filter(i => i.stock <= i.min);
            
            if (low.length === 0) {
                alerts.innerHTML = '<p class="text-muted">All items in stock</p>';
            } else {
                alerts.innerHTML = low.map(item => 
                    `<div class="alert alert-warning mb-2"><strong>${item.name}:</strong> ${item.stock}/${item.min}</div>`
                ).join('');
            }
        }

        function addInventory() {
            const item = {
                id: Date.now(),
                name: document.getElementById('invName').value,
                category: document.getElementById('invCategory').value,
                stock: parseInt(document.getElementById('invStock').value),
                min: parseInt(document.getElementById('invMin').value),
                cost: parseFloat(document.getElementById('invCost').value)
            };
            db.inventory.push(item);
            saveData();
            updateInventory();
            bootstrap.Modal.getInstance(document.getElementById('inventoryModal')).hide();
        }

        function deleteInv(id) {
            db.inventory = db.inventory.filter(i => i.id !== id);
            saveData();
            updateInventory();
        }

        function recordWaste() {
            const itemId = document.getElementById('wasteItem').value;
            const qty = parseInt(document.getElementById('wasteQty').value);
            
            const item = db.inventory.find(i => i.id == itemId);
            if (item && item.stock >= qty) {
                item.stock -= qty;
                saveData();
                updateInventory();
                alert('Waste recorded');
                document.getElementById('wasteQty').value = '';
            }
        }

        function updateSuppliers() {
            const list = document.getElementById('suppliersList');
            list.innerHTML = db.suppliers.map(s => `
                <div class="mb-2 p-2 bg-light rounded">
                    <strong>${s.name}</strong><br>
                    <small>${s.contact} | ${s.phone} | ${s.email}</small>
                </div>
            `).join('');
        }

        function addSupplier() {
            const supplier = {
                id: Date.now(),
                name: document.getElementById('supplierName').value,
                contact: document.getElementById('supplierContact').value,
                phone: document.getElementById('supplierPhone').value,
                email: document.getElementById('supplierEmail').value
            };
            db.suppliers.push(supplier);
            saveData();
            updateSuppliers();
            bootstrap.Modal.getInstance(document.getElementById('supplierModal')).hide();
        }

        // ===== FINANCIAL =====
        function updateFinancial() {
            const today = new Date().toLocaleDateString();
            const thisMonth = new Date().getMonth();
            
            const todayInc = db.income.filter(i => i.date === today).reduce((s, i) => s + i.amount, 0);
            const todayExp = db.expenses.filter(e => e.date === today).reduce((s, e) => s + e.amount, 0);
            
            const monthInc = db.income.filter(i => new Date(i.date).getMonth() === thisMonth).reduce((s, i) => s + i.amount, 0);
            const monthExp = db.expenses.filter(e => new Date(e.date).getMonth() === thisMonth).reduce((s, e) => s + e.amount, 0);

            document.getElementById('monthIncome').textContent = `$${monthInc.toFixed(2)}`;
            document.getElementById('monthExpense').textContent = `$${monthExp.toFixed(2)}`;
            document.getElementById('monthProfit').textContent = `$${(monthInc - monthExp).toFixed(2)}`;

            updateIncomeTable();
            updateExpenseTable();
            updateExpenseChart();
        }

        function updateIncomeTable() {
            document.getElementById('incomeTable').innerHTML = db.income.map(i => `
                <tr>
                    <td>${i.category}</td>
                    <td>$${i.amount.toFixed(2)}</td>
                    <td>${i.date}</td>
                    <td><button class="btn btn-sm btn-danger" onclick="deleteIncome(${i.id})">×</button></td>
                </tr>
            `).join('');
        }

        function updateExpenseTable() {
            document.getElementById('expenseTable').innerHTML = db.expenses.map(e => `
                <tr>
                    <td>${e.category}</td>
                    <td>$${e.amount.toFixed(2)}</td>
                    <td>${e.date}</td>
                    <td><button class="btn btn-sm btn-danger" onclick="deleteExpense(${e.id})">×</button></td>
                </tr>
            `).join('');
        }

        function addIncome() {
            db.income.push({
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                category: document.getElementById('incomeCategory').value,
                amount: parseFloat(document.getElementById('incomeAmount').value),
                description: document.getElementById('incomeDesc').value
            });
            saveData();
            updateFinancial();
            bootstrap.Modal.getInstance(document.getElementById('incomeModal')).hide();
        }

        function addExpense() {
            db.expenses.push({
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                category: document.getElementById('expenseCategory').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                description: document.getElementById('expenseDesc').value
            });
            saveData();
            updateFinancial();
            bootstrap.Modal.getInstance(document.getElementById('expenseModal')).hide();
        }

        function deleteIncome(id) {
            db.income = db.income.filter(i => i.id !== id);
            saveData();
            updateFinancial();
        }

        function deleteExpense(id) {
            db.expenses = db.expenses.filter(e => e.id !== id);
            saveData();
            updateFinancial();
        }

        function calculateBreakEven() {
            const fixed = parseFloat(document.getElementById('fixedCosts').value);
            const cost = parseFloat(document.getElementById('itemCost').value);
            const price = parseFloat(document.getElementById('itemPrice').value);
            const margin = price - cost;
            const breakEven = margin > 0 ? Math.ceil(fixed / margin) : 0;
            document.getElementById('breakEven').textContent = breakEven;
        }

        function updateExpenseChart() {
            const ctx = document.getElementById('expenseChart');
            if (!ctx) return;

            const cats = {};
            db.expenses.forEach(e => {
                cats[e.category] = (cats[e.category] || 0) + e.amount;
            });

            const chart = Chart.getChart(ctx);
            if (chart) chart.destroy();

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cats),
                    datasets: [{
                        data: Object.values(cats),
                        backgroundColor: ['#5C3D2E', '#8B6F47', '#D4A574', '#FFD700', '#FF9800', '#FF6B6B']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        // ===== STAFF =====
        function updateStaff() {
            document.getElementById('staffTable').innerHTML = db.staff.map(s => `
                <tr>
                    <td>${s.name}</td>
                    <td>${s.position}</td>
                    <td>$${s.salary.toFixed(2)}</td>
                    <td>${s.startDate}</td>
                    <td><button class="btn btn-sm btn-danger" onclick="deleteStaff(${s.id})">×</button></td>
                </tr>
            `).join('');

            const payroll = db.staff.reduce((s, st) => s + st.salary, 0);
            document.getElementById('totalPayroll').textContent = `$${payroll.toFixed(2)}`;

            const shiftSelect = document.getElementById('shiftStaff');
            shiftSelect.innerHTML = db.staff.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }

        function addStaff() {
            db.staff.push({
                id: Date.now(),
                name: document.getElementById('staffName').value,
                position: document.getElementById('staffPosition').value,
                salary: parseFloat(document.getElementById('staffSalary').value),
                startDate: document.getElementById('staffStart').value
            });
            saveData();
            updateStaff();
            bootstrap.Modal.getInstance(document.getElementById('staffModal')).hide();
        }

        function deleteStaff(id) {
            db.staff = db.staff.filter(s => s.id !== id);
            saveData();
            updateStaff();
        }

        function addShift() {
            alert('Shift added successfully');
            document.getElementById('shiftDate').value = '';
            document.getElementById('shiftStart').value = '';
            document.getElementById('shiftEnd').value = '';
        }

        function saveChecklist() {
            alert('Checklist saved');
        }

        // ===== LOYALTY =====
        function updateLoyalty() {
            document.getElementById('customerTable').innerHTML = db.customers.map(c => {
                const tier = c.points < 50 ? 'Bronze' : c.points < 100 ? 'Silver' : 'Gold';
                return `
                    <tr>
                        <td>${c.name}</td>
                        <td>${c.email}</td>
                        <td>${c.points}</td>
                        <td><span class="badge bg-warning">${tier}</span></td>
                        <td>${c.visits}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="addPoints(${c.id})">+10</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCust(${c.id})">×</button>
                        </td>
                    </tr>
                `;
            }).join('');

            const total = db.customers.length;
            const repeat = db.customers.filter(c => c.visits > 1).length;
            
            document.getElementById('totalCusts').textContent = total;
            document.getElementById('repeatCusts').textContent = repeat;
            document.getElementById('avgRating').textContent = '4.5★';
        }

        function addCustomer() {
            db.customers.push({
                id: Date.now(),
                name: document.getElementById('custName').value,
                email: document.getElementById('custEmail').value,
                phone: document.getElementById('custPhone').value,
                points: 0,
                visits: 0
            });
            saveData();
            updateLoyalty();
            bootstrap.Modal.getInstance(document.getElementById('customerModal')).hide();
        }

        function addPoints(id) {
            const cust = db.customers.find(c => c.id === id);
            if (cust) {
                cust.points += 10;
                cust.visits++;
                saveData();
                updateLoyalty();
            }
        }

        function deleteCust(id) {
            db.customers = db.customers.filter(c => c.id !== id);
            saveData();
            updateLoyalty();
        }

        // ===== STRATEGY =====
        function updateStrategy() {
            const today = new Date().toLocaleDateString();
            const todayOrders = db.orders.filter(o => o.date.includes(today));
            const sales = todayOrders.reduce((s, o) => s + o.total, 0);
            const avg = todayOrders.length > 0 ? (sales / todayOrders.length).toFixed(2) : 0;

            document.getElementById('avgTicket').textContent = `$${avg}`;
            document.getElementById('peakHour').textContent = '12:00 PM';
            document.getElementById('topProduct').textContent = 'Cappuccino';
            
            const repeat = db.customers.filter(c => c.visits > 1).length;
            const rate = db.customers.length > 0 ? ((repeat / db.customers.length) * 100).toFixed(0) : 0;
            document.getElementById('repeatRate').textContent = `${rate}%`;
        }

        function updateGoalProgress() {
            const target = parseFloat(document.getElementById('salesTarget').value);
            const thisMonth = new Date().getMonth();
            const sales = db.income.filter(i => new Date(i.date).getMonth() === thisMonth).reduce((s, i) => s + i.amount, 0);
            const percent = target > 0 ? Math.min((sales / target) * 100, 100) : 0;

            document.getElementById('goalBar').style.width = `${percent}%`;
            document.getElementById('goalBar').textContent = `${percent.toFixed(0)}%`;
        }

        function launchCampaign() {
            const name = document.getElementById('campaignName').value;
            alert(`Campaign "${name}" launched!`);
            document.getElementById('campaignName').value = '';
            document.getElementById('campaignImpact').value = '';
        }

        // ===== DASHBOARD =====
        function updateDashboard() {
            const today = new Date().toLocaleDateString();
            const todayInc = db.income.filter(i => i.date === today).reduce((s, i) => s + i.amount, 0);
            const todayExp = db.expenses.filter(e => e.date === today).reduce((s, e) => s + e.amount, 0);
            const profit = todayInc - todayExp;

            document.getElementById('dashIncome').textContent = `$${todayInc.toFixed(2)}`;
            document.getElementById('dashExpense').textContent = `$${todayExp.toFixed(2)}`;
            document.getElementById('dashProfit').textContent = `$${profit.toFixed(2)}`;
            document.getElementById('dashOrders').textContent = db.orders.filter(o => o.date.includes(today)).length;

            updateTopProducts();
            updateRecentOrders();
        }

        function updateTopProducts() {
            const products = db.products.slice(0, 5);
            document.getElementById('topProducts').innerHTML = '<ol>' + 
                products.map(p => `<li>${p.name}: <span class="badge bg-success">$${(p.price).toFixed(2)}</span></li>`).join('') + 
                '</ol>';
        }

        function updateRecentOrders() {
            const orders = db.orders.slice(-5).reverse();
            document.getElementById('recentOrders').innerHTML = orders.length === 0 ? 
                '<p class="text-muted">No orders</p>' :
                orders.map(o => `
                    <div class="order-item">
                        <div>
                            <strong>${o.date}</strong><br>
                            <small>${o.items.length} items</small>
                        </div>
                        <span class="badge bg-success">$${o.total.toFixed(2)}</span>
                    </div>
                `).join('');
        }

        // ===== REPORTS =====
        function updateReports() {
            updateTrendChart();
            updateProductChart();
        }

        function generateDailyReport() {
            const today = new Date().toLocaleDateString();
            const inc = db.income.filter(i => i.date === today).reduce((s, i) => s + i.amount, 0);
            const exp = db.expenses.filter(e => e.date === today).reduce((s, e) => s + e.amount, 0);
            
            db.reports.push({
                type: 'Daily',
                date: today,
                income: inc,
                expense: exp,
                profit: inc - exp
            });
            saveData();
            displayReports();
            alert('Daily report generated');
        }

        function generateWeeklyReport() {
            alert('Weekly report generated');
        }

        function generateMonthlyReport() {
            alert('Monthly report generated');
        }

        function displayReports() {
            const list = document.getElementById('reportsList');
            list.innerHTML = db.reports.length === 0 ? '<p class="text-muted">No reports</p>' :
                db.reports.map(r => `
                    <div class="alert alert-info mb-2">
                        <strong>${r.type} (${r.date}):</strong> Income $${r.income.toFixed(2)} | Expense $${r.expense.toFixed(2)} | Profit $${r.profit.toFixed(2)}
                    </div>
                `).join('');
        }

        function exportData() {
            const json = JSON.stringify(db, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `coffee-shop-${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        function updateTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;

            const days = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                days.push(d.toLocaleDateString());
            }

            const sales = days.map(day => db.orders.filter(o => o.date.includes(day)).reduce((s, o) => s + o.total, 0));

            const chart = Chart.getChart(ctx);
            if (chart) chart.destroy();

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days.map(d => d.substring(5)),
                    datasets: [{
                        label: 'Sales',
                        data: sales,
                        borderColor: '#8B6F47',
                        backgroundColor: 'rgba(139, 111, 71, 0.1)',
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function updateProductChart() {
            const ctx = document.getElementById('productChart');
            if (!ctx) return;

            const prods = db.products.slice(0, 6);
            const sales = prods.map(() => Math.random() * 20);

            const chart = Chart.getChart(ctx);
            if (chart) chart.destroy();

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: prods.map(p => p.name),
                    datasets: [{
                        label: 'Units',
                        data: sales,
                        backgroundColor: '#8B6F47'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        // ===== INIT =====
        loadData();
        updateDashboard();
    </script>
</body>
</html>